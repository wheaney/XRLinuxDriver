import sys
import os
import yaml

start_date = 0
end_date = 0
target_device_vendor_id = 0
target_device_product_id = 0

yaml_file_path = sys.argv[1]
output_file_path = sys.argv[2]
if os.path.isfile(yaml_file_path):
    with open(yaml_file_path, 'r') as stream:
        try:
            yaml_data = yaml.safe_load(stream)
        except yaml.YAMLError as exc:
            print(exc)
            sys.exit(1)

    try:
        start_date = int(yaml_data.get("start_date", 0))
    except ValueError:
        print("ERROR: start_date is not an int")
        sys.exit(1)

    try:
        end_date = int(yaml_data.get("end_date", 0))
    except ValueError:
        print("ERROR: end_date is not an int")
        sys.exit(1)

    try:
        target_device_vendor_id = int(yaml_data.get("target_device_vendor_id", 0))
        if target_device_vendor_id != 0:
            try:
                target_device_product_id = int(yaml_data.get("target_device_product_id", 0))
            except ValueError:
                print("ERROR: target_device_product_id is not an int")
                sys.exit(1)
    except ValueError:
        print("ERROR: target_device_vendor_id is not an int")
        sys.exit(1)

    if end_date != 0 and start_date != 0 and start_date > end_date:
        print("ERROR: start_date is after end_date")
        sys.exit(1)

with open(output_file_path, "w") as f:
    f.write("#pragma once\n")
    f.write("// This file is autogenerated by bin/custom_banner_build.py\n")
    f.write("// Do not edit this file directly\n")
    f.write("#define CUSTOM_BANNER_START_DATE {}\n".format(start_date))
    f.write("#define CUSTOM_BANNER_END_DATE {}\n".format(end_date))
    f.write("#define CUSTOM_BANNER_TARGET_DEVICE_VENDOR_ID {}\n".format(target_device_vendor_id))
    f.write("#define CUSTOM_BANNER_TARGET_DEVICE_PRODUCT_ID {}\n".format(target_device_product_id))